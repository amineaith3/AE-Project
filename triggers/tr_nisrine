CREATE OR REPLACE TRIGGER trg_minor_guardian 
BEFORE INSERT ON passengers 
FOR EACH ROW 
DECLARE 
  v_age_guardian NUMBER; 
BEGIN 
  IF :NEW.age_pass < 18 THEN 
     IF :NEW.guardian_id IS NULL THEN
         RAISE_APPLICATION_ERROR ( -20001 ,'Un passager mineur doit avoir un guardian.') ; 
     END IF ;
     BEGIN 
        SELECT age_pass 
        INTO v_age_guardian 
        FROM passengers 
        WHERE :NEW.guardian_id = passenger_id 
     EXCEPTION 
        WHEN NO_DATA_FOUND THEN 
        RAISE_APPLICATION_ERROR(-20001,'ID de ce guardian n''existe pas.'); 
     END ; 
     IF v_age_guardian <18 THEN 
        RAISE_APPLICATION_ERROR(-20001,'le guardien doit etre un adulte.'); 
  END IF ; 
END ;
