CREATE OR REPLACE PROCEDURE ajouter_passengers (
       p_Passenger_id  IN NUMBER ,
       p_prenom IN VARCHAR2,
       p_nom IN VARCHAR2,
       p_NumPasseport IN NUMBER,
       p_Contact IN VARCHAR2,
       p_Nationality IN VARCHAR2 
)
IS 
    v_count NUMBER 
    
    
BEGIN 
 
    IF p_prenom IS NULL OR p_nom IS NULL OR p_Contact IS NULL THEN
      DBMS_OUTPUT.PUT_LINE('Erreur : les champs prénom, nom et contact sont obligatoires.');
      RETURN;
    END IF;


   IF INSTR(p_Contact, '@') = 0 THEN
     DBMS_OUTPUT.PUT_LINE('Erreur : email invalide.');
     RETURN;
   END IF;

   SELECT COUNT(*) INTO v_count
   FROM passengers 
   WHERE passenger_id = p_passenger_id 
         OR numPasseport = p_NumPasseport;
 
   IF v_count > 0 THEN 
   DBMS_OUTPUT.PUT_LINE('Erreur : ID ou numéro de passeport déjà existant.');
   
   ELSE 
       INSERT INTO passengers ( 
                                Passenger_id,
                                prenom,
                                nom,
                                NumPasseport,
                                Contact,
                                Nationality ) 
       VALUES ( p_Passenger_id, 
                p_prenom,
                p_nom,
                p_NumPasseport, 
                p_Contact,
                p_Nationality ); 
       COMMIT;
       DBMS_OUTPUT.PUT_LINE('Passager ajouté avec succès.');
   END IF; 

EXCEPTION 
     WHEN DUP_VAL_ON_INDEX THEN 
          DBMS_OUTPUT.PUT_LINE('ERREUR: ID PASSENGER DEJA EXISTANT');
     WHEN VALUE_ERROR THEN
          DBMS_OUTPUT.PUT_LINE('Erreur : type de donnée invalide.');     
     WHEN OTHERS THEN 
          DBMS_OUTPUT.PUT_LINE('ERREUR:' || SQLERRM );
     
END ajouter_passengers ; 
/
